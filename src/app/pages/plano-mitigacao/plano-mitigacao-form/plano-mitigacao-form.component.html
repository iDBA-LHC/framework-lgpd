<mat-card class="marginContent">
  <div class="mat-elevation-z8">

    <div *ngIf="isLoading" class="overlay-spinner">
      <div class="center-spinner">
        <mat-spinner style="align-self: center; margin: 0 auto;"></mat-spinner>
      </div>
    </div>

    <div>
      <form fxLayout="row wrap" fxLayout="column"
        fxLayoutAlign="space-between center" fxFlex="100" fxFlex.gt-sm="100"
        [formGroup]="planoMitigacaoForm" (submit)="salvarPlanoMitigacao()">

        <mat-card-header>
          <mat-card-title>
            <h2 *ngIf="!codPlanoMitigacao">Novo Plano Mitigação</h2>
            <h2 *ngIf="codPlanoMitigacao">Editar Plano Mitigação</h2>
          </mat-card-title>
        </mat-card-header>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>Código Plano Mitigação</mat-label>
          <input matInput formControlName="codPlanoMitigacao" placeholder="Código Plano Mitigação" autocomplete="off"
            type="number" />
          <mat-error *ngIf="planoMitigacaoForm.controls.codPlanoMitigacao.errors?.required">Código Plano Mitigação é
            Obrigatório</mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>Código Data Mapping</mat-label>
          <input matInput formControlName="codDataMapping" placeholder="Código Data Mapping" autocomplete="off"
            type="number" />
          <mat-error *ngIf="planoMitigacaoForm.controls.codDataMapping.errors?.required">Código Data Mapping é
            Obrigatório</mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>Descrição Plano Mitigação</mat-label>
          <input matInput formControlName="desPlanoMitigacao" placeholder="Descrição Plano Mitigação" autocomplete="off"
            type="string" />
          <mat-error *ngIf="planoMitigacaoForm.controls.desPlanoMitigacao.errors?.required">Descrição Plano Mitigação é
            Obrigatório</mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>Descrição observação</mat-label>
          <input matInput formControlName="desObservacao" placeholder="Descrição observação" autocomplete="off"
            type="string" />
          <mat-error *ngIf="planoMitigacaoForm.controls.desObservacao.errors?.required">Descrição observação é
            Obrigatório</mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>data limite</mat-label>
          <input matInput formControlName="dataLimite" placeholder="data limite" [matDatepicker]="picker6" />
          <mat-datepicker-toggle matSuffix [for]="picker6"></mat-datepicker-toggle>
          <mat-datepicker #picker6></mat-datepicker>
          <mat-error *ngIf="planoMitigacaoForm.controls.dataLimite.errors?.required">data limite é Obrigatória
          </mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>Nome propõe ajuste</mat-label>
          <input matInput formControlName="nomePropoeAjuste" placeholder="Nome propõe ajuste" autocomplete="off"
            type="number" />
          <mat-error *ngIf="planoMitigacaoForm.controls.nomePropoeAjuste.errors?.required">Nome propõe ajuste é
            Obrigatório</mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>Nome Aprovador</mat-label>
          <input matInput formControlName="nomeAprovador" placeholder="Nome Aprovador" autocomplete="off"
            type="string" />
          <mat-error *ngIf="planoMitigacaoForm.controls.nomeAprovador.errors?.required">Nome Aprovador é Obrigatório
          </mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>data Elaboração</mat-label>
          <input matInput formControlName="dataElaboracao" placeholder="data Elaboração" [matDatepicker]="picker5" />
          <mat-datepicker-toggle matSuffix [for]="picker5"></mat-datepicker-toggle>
          <mat-datepicker #picker5></mat-datepicker>
          <mat-error *ngIf="planoMitigacaoForm.controls.dataElaboracao.errors?.required">data Elaboração é Obrigatória
          </mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>data Aditivação</mat-label>
          <input matInput formControlName="dataAditivacao" placeholder="data Aditivação" [matDatepicker]="picker1" />
          <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
          <mat-error *ngIf="planoMitigacaoForm.controls.dataAditivacao.errors?.required">data Aditivação é Obrigatória
          </mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>data Revisao</mat-label>
          <input matInput formControlName="dataRevisao" placeholder="data Revisao" [matDatepicker]="picker2" />
          <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
          <mat-datepicker #picker2></mat-datepicker>
          <mat-error *ngIf="planoMitigacaoForm.controls.dataRevisao.errors?.required">data Revisao é Obrigatória
          </mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>data Recusa</mat-label>
          <input matInput formControlName="dataRecusa" placeholder="data Recusa" [matDatepicker]="picker3" />
          <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
          <mat-datepicker #picker3></mat-datepicker>
          <mat-error *ngIf="planoMitigacaoForm.controls.dataRecusa.errors?.required">data Recusa é Obrigatória
          </mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>Descrição Motivo Recusa</mat-label>
          <input matInput formControlName="desMotivoRecusa" placeholder="Descrição Motivo Recusa" autocomplete="off"
            type="number" />
          <mat-error *ngIf="planoMitigacaoForm.controls.desMotivoRecusa.errors?.required">Descrição Motivo Recusa é
            Obrigatório</mat-error>
        </mat-form-field>

        <mat-form-field fxFlex style="width: 50%;" fxFlexOffset="5px">
          <mat-label>data Status</mat-label>
          <input matInput formControlName="dataStatus" placeholder="data Status" [matDatepicker]="picker4" />
          <mat-datepicker-toggle matSuffix [for]="picker4"></mat-datepicker-toggle>
          <mat-datepicker #picker4></mat-datepicker>
          <mat-error *ngIf="planoMitigacaoForm.controls.dataStatus.errors?.required">data Status é Obrigatória
          </mat-error>
        </mat-form-field>

        <mat-card-actions>
          <button mat-raised-button color="accent">Salvar</button>
        </mat-card-actions>
      </form>
    </div>
  </div>

  <mat-expansion-panel *ngIf="codPlanoMitigacao" [expanded]="true" class="nested-form mat-elevation-z8 marginContent">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Documento Plano
      </mat-panel-title>
    </mat-expansion-panel-header>


    <div class="marginContent">
      <div fxLayout="row">
        <div fxFlex>
          <mat-form-field fxFlex="30">
            <input
              matInput
              (keyup)="applyFilterProcesso($event.target.value)"
              placeholder="Buscar Processo"/>
          </mat-form-field>
        </div>
        <div fxLayout="row" fxLayoutGap="5px">
          <div fxLayout="column" fxLayoutAlign="start end">
            <a
              mat-raised-button
              color="accent"
              [routerLink]="['/plano-mitigacao', codPlanoMitigacao, 'documento-plano', '']"
              routerLinkActive="active">
              <mat-icon>add</mat-icon>Novo Documento Plano</a>
          </div>
        </div>
      </div>

      <div class="mat-elevation-z8" [hidden]="isLoading">
        <table mat-table [dataSource]="dataSourceDocumentoPlano" matSort>
          <ng-container matColumnDef="desDocumentoPlano">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Nome</th>
            <td mat-cell *matCellDef="let element; let i = index">{{ element.desDocumentoPlano }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element">
              <div class="example-button-row">
                <button
                  mat-raised-button
                  color="accent"
                  [routerLink]="['/plano-mitigacao', element.codPlanoMitigacao, 'documento-plano', element.codDocumentoPlano]">
                  Editar
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    </div>

  </mat-expansion-panel>

</mat-card>
